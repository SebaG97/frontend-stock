<p-toast></p-toast>
<div class="card p-6">
  <div class="flex justify-content-between align-items-center mb-3">
    <h5>Historial de movimientos de stock</h5>
    <button pButton label="Nuevo Movimiento" icon="pi pi-plus" (click)="openNew()"></button>
  </div>
  <p-table [value]="movimientos" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,25,50]" [loading]="loading" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>Fecha</th>
        <th>Producto</th>
        <th>Dep√≥sito</th>
        <th>Cantidad</th>
        <th>Tipo</th>
        <th>Motivo</th>
        <th>Empresa</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-movimiento>
      <tr>
        <td>{{ movimiento.fecha | date:'short' }}</td>
        <td>{{ movimiento.producto?.descripcion || '-' }}</td>
        <td>{{ movimiento.deposito?.nombre || '-' }}</td>
        <td>{{ movimiento.cantidad }}</td>
        <td>{{ movimiento.tipo }}</td>
        <td>{{ movimiento.motivo || '-' }}</td>
        <td>{{ movimiento.cliente_empresa || '-' }}</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7">No hay movimientos registrados</td>
      </tr>
    </ng-template>
  </p-table>
  <p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width: '400px'}" [closable]="false">
    <ng-template pTemplate="header">Nuevo Movimiento</ng-template>
    <ng-template pTemplate="content">
      <app-movimiento-form [movimiento]="selectedMovimiento" [productos]="productos" [depositos]="depositos" (save)="onSave($event)" (cancel)="onCancel()"></app-movimiento-form>
    </ng-template>
  </p-dialog>
</div>
